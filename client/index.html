<!DOCTYPE html>
<html ng-app="app">

<head>
    <title>Framework</title>
    <script src="angular/angular.js"></script>
    <script src="angular-route/angular-route.js"></script>
    <script src="angular-cookies/angular-cookies.js"></script>
    <script src="angular-easyfb/src/angular-easyfb.js"></script>
    <script src="angularUtils-pagination/dirPagination.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="assets/app.js"></script>
    <script src="factory/dashboard_factory.js"></script>
    <script src="factory/socket_factory.js"></script>
    <script src="controllers/user_controller.js"></script>
    <script src="controllers/dashboard_controller.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjRPy2x2UStWmZ9dsB7PrUoDhYSYssWYA&callback=initMap" async defer></script>
    <style>
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
    
    #map {
        height: 400px;
        width: 400px;
    }
    </style>
    <script>
    var map;

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 37.37547033291706,
                lng: -121.91041984504002
            },
            zoom: 10
        });
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, hidePosition);
        } else {
            alert('Geolocation not supported. Detected by IP addresss');
            ipPosition();
        }
    }

    function showPosition(position) {
        pos = {
            lat: parseFloat(position.coords.latitude),
            lng: parseFloat(position.coords.longitude)
        };
    }

    function hidePosition(position) {
        alert('User denied the access of the position. Now we trying to get your location through your IP address.');
        ipPosition();
    }

    function ipPosition() {
        $.get("http://ipinfo.io", function(response) {
            var loc = response.loc.split(',');
            pos = {
                lat: parseFloat(loc[0]),
                lng: parseFloat(loc[1])
            };
        }, "jsonp");
    }
    getLocation();
    </script>
    <script>
    var markers = [];
    var getMarkerUniqueId = function(lat, lng) {
        return lat + "_" + lng;
    }

    function addMarker(location) {
        var markerId = getMarkerUniqueId(location.lat, location.lng);
        var marker = new google.maps.Marker({
            position: location,
            map: map,
            animation: google.maps.Animation.DROP,
            id: markerId
        });
        markers[markerId] = marker;
    }

    var removeMarker = function(marker, markerId) {
        market.setMap(null);
        delete markets[markerId];
    }
    </script>
</head>

<body>
    <div ng-view></div>
</body>

</html>
